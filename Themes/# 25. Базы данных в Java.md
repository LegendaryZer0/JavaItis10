# 25. Базы данных в Java

* Проблема - баз данных очень много, Java одна, программистам неудобно писать код взаимдействя с базой данных каждый раз для каждой СУБД.

* JDBC - JavaDatabaseConnectivity - это пакет `java.sql` в котором описаны все интерфейсы и классы для взаимодействия с БД + набор классов-драйверов для каждой СУБД. То есть вы пользуетесь интерфейсами, а реализации для них берутся из драйвера.

## 25.00 Интерфейсы `java.sql`

* `Connection` - интерфейс, описывающий поведение класса, объекты которого представляют собой подключение к бд.

* `DriverManager` - класс, отвечающий за создание объектов `Connection` с использованием подключенного драйвера.

* `Statement` - интерфейс, описвающий поведение класса, объекты которого представляют собой `выражения` для отправки запросов в БД и получения данных оттуда.

* `ResultSet` - интерфейс, описывающий поведение класса, объекты которго представляют собой итератор по результатам выборки.

* `PreparedStatement` - прекомпилированный запрос, требует строгой типизации запроса, позволяет избежать SQL-инъекции.

## 25.01 SQL-инъекция

* Возможна, когда на сервере используется конкатенация и `Statement` для выполнения запросов. 

* В качестве параметра запроса можно передать SQL-код, который будет выполнен сервером.

Например:

* Код для Statement:

```JAVA
String query = "insert into service_user(first_name) values ('" + firstName + "');";
```

* firstName:

```
Надир'); DROP TABLE CAR; insert into service_user(first_name) values ('haha
```

* Сгенерированный запрос:

```
insert into service_user(first_name) values ('Надир'); DROP TABLE CAR; insert into service_user(first_name) values ('haha');
```

* Чтобы избежать SQL-инъекции используем `PreparedStatement`

## 25.02 JdbcTemplate

* Класс, компонент библиотеки фреймворка Spring - spring-jdbc. Представляет собой класс, в котором уже реализованы все шаблонные методы для работы с БД. И самое приятное - он избавляет вас от проверяемых исключений.

* `DataSource` - стандартный интерфейс, который позволяет другим компонентам приложения работать с БД. Имеем метод:

```JAVA
Connection getConnection() throws SQLException;
```

* `DriverManager` - стандартный класс, который сканирует `classpath` на наличие драйвера и предоставляет `Connection`. Не используется в `production`, поскольку механизмы работы с подключением к БД достаточно примитивные и не особо эффективные.

* `DriverManagerDataSource` - класс фреймворка Spring, представляет собой реализацию `DataSource` на основе класса `DriverManager`. Поскольку использует `DriverManager`, `DriverManagerDataSource` так же не рекомендуется в `productuion`. Подходит для тестирования и написания простых приложений. `DriverManagerDataSource` - это класс-адаптер (см. паттерн Адаптер) для `DriverManager`, чтобы его можно было использовать в Spring.

