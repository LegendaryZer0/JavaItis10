# 24. Базы данных

## 24.00 Проблемы, возникающие при огранизации работы с данными через обычные файлы

* Нет единообразия данных - проблемы переносимости данных.

* Нет ограничителей для соблюдения корректности данных

* Все методы для получения данных необходимо реализовать самому, и не факт что они будут работать эффективно.

* Нет удобных механизмов резервного копирования данных, либо их надо писать самому.

* Нет средств для соблюдения консистентности данных, либо их надо писать самому.

## Базы данных

* Эффективные механизмы хранения данных

* Мощные механизмы резервного копирования

* Механизмы для соблюдения корректности данных, целостности и консистентности.

* Языки для построения эффективных запросов на получение данных, удаление, обновление и т.д.

* Базы данных - специализированное программное обеспечение для работы с данными.

## 24.01 Реляционные базы данных

* Состоят из таблиц.

* Каждая таблица состоит из строк и столбцов.

* Каждый столбец имеет строго определенный тип и уникальное имя в рамках таблицы.

* Строка - представляет собой набор конкретных значений, согласованных с колонками.

```
service_user - название таблицы

|id     |first_name |is_man |
|INTEGER|VARCHAR(50)|BOOLEAN|
-----------------------------
       7| Marsel    |true   |
```

* Реляционные - значит есть отношения между таблицами.

```
car - таблица машин

|id     |model      |owner_id |
|INTEGER|VARCHAR(50)|INTEGER  |
-------------------------------
       1|Camry      |        7|
       2|Land Rover |       10| <- данные внесены не будут

id - первичный ключ (PRIMARY KEY)
owner_id - внешний ключ (FOREIGN KEY)
```

* Отношение между таблицами `car` и `service_user`

* Первичный ключ - это идентификатор строки. Всегда уникален в рамках таблицы. Обычно числовой.

* Внешний ключ - ссылка на какую-либо колонку другой таблицы (чаще всего на первичный ключ другой таблицы).

* SQL - структурированный язык запросов для работы с данными в реляционных бд.

* СУБД - программное обеспечение, которое осуществляет работу с базами данных. Как правило представляет собой панель администратора, ПО для взаимодействия с файлами баз данных и собственно, сами файлы для хранения. 

* СУБД - всегда клиент-серверные приложения. То есть на каком-либо устройстве поднимается приложение-сервер, оно имеет прямой доступ к данным. Далее, любое другое приложение является клиентом для этого сервера и может дергать оттуда данные.

* Различные дистрибутивы СУБД:

1. Oracle
2. MySQL (кто-то купил)
3. PostgreSQL
4. MS SQL
5. SQLite
6. HQLDB
и т.д.

## 24.02 SQL

* Создание таблицы

```SQL
create table service_user (
	-- id integer not null unique primary key,
	id bigserial primary key,
	first_name varchar(20),
	last_name varchar(20),
	age integer,
	phone varchar(20),
	email varchar(100),
	login varchar(100),
	password varchar(100),
	role varchar(10)
);
```

* Внесение данных с `id` (если колонка `serial` то вносим ОБЯЗАТЕЛЬНО БЕЗ ID)

```SQL
insert into service_user
(id, first_name, last_name, age, phone, 
 email, login, password, role) values (1, 'Марсель', 'Сидиков',
									  25, '+79372824941', 
									   'sidikov.marsel@gmail.com', 
									   'marsel', 'qwerty007', 'USER');
```

* Если при `insert` не указать название колонки и ее значение, туда будет внесено `NULL`

* `NULL` в SQL означает неопределенность.

* Получение всех колонок из таблицы

```SQL
select * from service_user;
```

* Получение конкретных колонок из таблицы

```SQL
select first_name, last_name from service_user;
```

* Получение строк из таблцы по определенному условию

```SQL
select first_name, last_name from service_user where age < 24;
```

* Комбинированное условие

```SQL
select first_name, last_name from service_user where age < 24 or first_name = 'Марсель'
```

* Левое пересечение - все строки из левой и пересекаемые с правой.

```SQL
select su.id as user_id, su.first_name, su.last_name, c.id as car_id, c.model
from service_user su
       left join car c on su.id = c.owner_id;
```

* Правое пересечение - все строки из правой таблицы, пересекаемые слева.

```SQL
select su.id as user_id, su.first_name, su.last_name, c.id as car_id, c.model
from service_user su
       right join car c on su.id = c.owner_id
```

* Внутреннее пересечение - пересекаемые слева и справа.

```SQL
select su.id as user_id, su.first_name, su.last_name, c.id as car_id, c.model
from service_user su
       inner join car c on su.id = c.owner_id;
```

* Полное пересечение - все данные справа и слева.

```SQL
select su.id as user_id, su.first_name, su.last_name, c.id as car_id, c.model
from service_user su
       full outer join car c on su.id = c.owner_id;
```

* Изучить дополнительно - `GROUP BY`, `ORDER BY`, `DICSTINCT`